{% extends 'base.html' %}

{% block content%}
<div class="w3-row">
    <!-- Sidebar -->
    <div class="w3-col" style="width: 230px; background-color: #373a36; min-height: 100vh;">
        <div class="w3-container w3-padding">
            <a href="{{ url_for('user_management') }}" class="w3-button w3-block w3-margin-top w3-round" style="background-color: #d48166; color: rgba(255, 255, 255, 0.747); white-space: nowrap; padding-left: 8px; padding-right: 8px;">USER MANAGEMENT</a>
            <a href="{{ url_for('student_management') }}" class="w3-button w3-block w3-margin-top w3-round" style="background-color: #d48166; color: rgba(255, 255, 255, 0.747); white-space: nowrap; padding-left: 8px; padding-right: 8px;">STUDENT MANAGEMENT</a>
            <a href="{{ url_for('view_attendance') }}" class="w3-button w3-block w3-margin-top w3-round" style="background-color: #d48166; color: rgba(255, 255, 255, 0.747); white-space: nowrap; padding-left: 8px; padding-right: 8px;">VIEW ATTENDANCE</a>
            <a href="{{ url_for('logout') }}" class="w3-button w3-block w3-margin-top w3-round" style="background-color: #d48166; color: rgba(255, 255, 255, 0.747); white-space: nowrap; padding-left: 8px; padding-right: 8px;">LOGOUT</a>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="w3-rest">
        <div class="w3-container w3-padding">
            <div class="w3-row w3-margin-bottom">
                <div class="w3-col m12" style="display: flex; align-items: center; justify-content: space-between;">
                    <h3 style="margin: 0;">USER MANAGEMENT</h3>
                    <button class="w3-button w3-round" style="background-color: #4d724d; color: #f5f5f5" onclick="openAddAdminModal()">Add New Admin</button>
                </div>
            </div>
            
            <div class="w3-row-padding">
                <!-- Add User Form -->
                <div class="w3-col" style="width: 360px;">
                    <div class="w3-card-4 w3-padding">
                        <form method="POST" action="{{ url_for('save_user') }}" id="userForm">
                            <input type="hidden" name="user_id" id="user_id">
                            <p>
                                <input type="text" name="name" id="name" class="w3-input w3-border" placeholder="name" required>
                            </p>
                            <p>
                                <input type="email" name="email" id="email" class="w3-input w3-border" placeholder="email" required>
                            </p>
                            <p>
                                <input type="password" name="password" id="password" class="w3-input w3-border" placeholder="password" required>
                            </p>
                            <p class="w3-center">
                                <button type="submit" class="w3-button w3-indigo w3-round" style="min-width: 100px;">SAVE</button>
                                <button type="button" class="w3-button w3-round" style="min-width: 100px; margin-left: 10px; background-color: #ced4da;" onclick="clearForm()">CLEAR</button>
                            </p>
                        </form>
                    </div>
                </div>
                
                <!-- User List Table -->
                <div class="w3-rest" style="margin-left: 20px;">
                    <table class="w3-table-all w3-hoverable">
                        <thead>
                            <tr style="background-color: #a0aecd; color: #000000;">
                                <th style="text-align: center;">ID</th>
                                <th>NAME</th>
                                <th>EMAIL</th>
                                <th style="text-align: center;">PASSWORD</th>
                                <th style="text-align: center;">ACTION</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr>
                                <td style="text-align: center;">{{ user['id'] }}</td>
                                <td>{{ user['name'] }}</td>
                                <td>{{ user['email'] }}</td>
                                <td style="text-align: center;">********</td>
                                <td style="text-align: center;">
                                    <button class="w3-button w3-small w3-info w3-border edit-user-btn" data-id="{{ user['id'] }}" data-email="{{ user['email'] }}" data-name="{{ user['name'] }}" style="font-size: 18px;">
                                            ‚úèÔ∏è
                                    </button>
                                    <form method="POST" action="{{ url_for('delete_user_route', user_id=user['id']) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this admin?');">
                                        <button type="submit" class="w3-button w3-small w3-danger w3-border">
                                            üóëÔ∏è
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Add event listeners to all edit buttons
document.addEventListener('DOMContentLoaded', function() {
    var editButtons = document.querySelectorAll('.edit-user-btn');
    editButtons.forEach(function(button) {
        button.addEventListener('click', function() {
            var id = this.getAttribute('data-id');
            var email = this.getAttribute('data-email');
            var name = this.getAttribute('data-name');
            editUser(id, email, name);
        });
    });
});

function editUser(id, email, name) {
    document.getElementById('user_id').value = id;
    document.getElementById('name').value = name;
    document.getElementById('email').value = email;
    document.getElementById('password').value = '';
    document.getElementById('password').placeholder = 'Enter new password';
}

function clearForm() {
    document.getElementById('userForm').reset();
    document.getElementById('user_id').value = '';
    document.getElementById('password').placeholder = 'password';
}

// Modal functions
function openAddAdminModal() {
    document.getElementById('addAdminModal').style.display = 'block';
}

function closeAddAdminModal() {
    document.getElementById('addAdminModal').style.display = 'none';
}

// Close modal when clicking outside of it
window.onclick = function(event) {
    var modal = document.getElementById('addAdminModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}
</script>

<!-- Modal for Adding New Admin -->
<div id="addAdminModal" class="w3-modal" style="display: none;">
    <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width: 400px; margin-top: 100px;">
        <div class="w3-container w3-padding" style="background-color: #a0aecd;">
            <span onclick="closeAddAdminModal()" class="w3-button w3-display-topright" style="font-size: 20px; cursor: pointer; background-color: #a0aecd; color: #000000"><b>&times;</b></span>
            <h4 style="color: #000000; margin: 0;"><b>ADD NEW ADMIN</b></h4> 
        </div>
        <form method="POST" action="{{ url_for('save_user') }}" class="w3-container w3-padding">
            <p>
                <label><b>Name</b></label>
                <input type="text" name="name" class="w3-input w3-border w3-margin-bottom" placeholder="Enter admin name" required>
            </p>
            <p>
                <label><b>Email</b></label>
                <input type="email" name="email" class="w3-input w3-border w3-margin-bottom" placeholder="Enter email address" required>
            </p>
            <p>
                <label><b>Password</b></label>
                <input type="password" name="password" class="w3-input w3-border w3-margin-bottom" placeholder="Enter password" required>
            </p>
            <p class="w3-center w3-margin-top">
                <button type="submit" class="w3-button w3-indigo w3-round w3-margin-right">SAVE</button>
                <button type="button" class="w3-button w3-round" style="background-color: #ced4da;" onclick="closeAddAdminModal()">CANCEL</button>
            </p>
        </form>
    </div>
</div>

{% endblock %}